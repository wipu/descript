<html><head>
<style type='text/css'>
body {font: 12px verdana, arial, sans-serif;}
.text {width:65em;}
.console {background-color:black;font-family:monospace;margin-left:33px;width:60em;}
.prompt {font-weight:bold;color:green;}
.cmd {color:white;}
.output {color:gray;}
.output-asserted {font-size:8px; background-color: #def9de;; margin-left:33px;}
.editor {border-style:solid;border-width:1px;margin-left:30px;margin-top:5px;margin-bottom:5px;background-color: #ffffd0;;width:60em;padding:2px;}
div.line {white-space:pre;margin-bottom:1px;}
div.add  {background-color: #def9de;;}
div.del  {background-color: #f9dede;; text-decoration:line-through;}
div.keep {background-color: #ffffff;;}
</style>
</head><body>
<h2>Forged prompt shows current working directory</h2>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>m<img width="0" />k<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" /> <img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" />
</span></div>
<div class='console output'></div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>c<img width="0" />d<img width="0" /> <img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" />
</span></div>
<div class='console output'></div>
<div class='console'><span class='prompt'>~<img width="0" />/<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" /> $ </span><span class='cmd'>m<img width="0" />k<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" /> <img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />2<img width="0" />
</span></div>
<div class='console output'></div>
<div class='console'><span class='prompt'>~<img width="0" />/<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" /> $ </span><span class='cmd'>c<img width="0" />d<img width="0" /> <img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />2<img width="0" />
</span></div>
<div class='console output'></div>
<div class='console'><span class='prompt'>~<img width="0" />/<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" />/<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />2<img width="0" /> $ </span><span class='cmd'>c<img width="0" />d<img width="0" /> <img width="0" />.<img width="0" />.<img width="0" />
</span></div>
<div class='console output'></div>
<div class='console'><span class='prompt'>~<img width="0" />/<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" /> $ </span><span class='cmd'>c<img width="0" />d<img width="0" /> <img width="0" />.<img width="0" />.<img width="0" />
</span></div>
<div class='console output'></div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>#<img width="0" /> <img width="0" />b<img width="0" />a<img width="0" />c<img width="0" />k<img width="0" />
</span></div>
<div class='console output'></div>
<h2>Console shows all whitespace and overlong lines</h2>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" /> <img width="0" />"<img width="0" />a<img width="0" />l<img width="0" />l<img width="0" /> <img width="0" /> <img width="0" />"<img width="0" /> <img width="0" /> <img width="0" /> <img width="0" />w<img width="0" />h<img width="0" />i<img width="0" />t<img width="0" />e<img width="0" />s<img width="0" />p<img width="0" />a<img width="0" />c<img width="0" />e<img width="0" /> <img width="0" />i<img width="0" />s<img width="0" /> <img width="0" />p<img width="0" />r<img width="0" />e<img width="0" />s<img width="0" />e<img width="0" />r<img width="0" />v<img width="0" />e<img width="0" />d<img width="0" /> <img width="0" /> <img width="0" /> <img width="0" /> <img width="0" /> <img width="0" />.<img width="0" />
</span></div>
<div class='console output'>a<img width="0" />l<img width="0" />l<img width="0" /> <img width="0" /> <img width="0" /> <img width="0" />w<img width="0" />h<img width="0" />i<img width="0" />t<img width="0" />e<img width="0" />s<img width="0" />p<img width="0" />a<img width="0" />c<img width="0" />e<img width="0" /> <img width="0" />i<img width="0" />s<img width="0" /> <img width="0" />p<img width="0" />r<img width="0" />e<img width="0" />s<img width="0" />e<img width="0" />r<img width="0" />v<img width="0" />e<img width="0" />d<img width="0" /> <img width="0" />.<img width="0" />
</div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />"<img width="0" /> <img width="0" /> <img width="0" />A<img width="0" />n<img width="0" />d<img width="0" /> <img width="0" />o<img width="0" />v<img width="0" />e<img width="0" />r<img width="0" />l<img width="0" />o<img width="0" />n<img width="0" />g<img width="0" /> <img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />s<img width="0" /> <img width="0" />a<img width="0" />r<img width="0" />e<img width="0" /> <img width="0" />b<img width="0" />r<img width="0" />o<img width="0" />k<img width="0" />e<img width="0" />n<img width="0" /> <img width="0" />a<img width="0" />u<img width="0" />t<img width="0" />o<img width="0" />m<img width="0" />a<img width="0" />t<img width="0" />i<img width="0" />c<img width="0" />a<img width="0" />l<img width="0" />l<img width="0" />y<img width="0" />,<img width="0" /> <img width="0" />b<img width="0" />u<img width="0" />t<img width="0" /> <img width="0" />t<img width="0" />h<img width="0" />e<img width="0" />r<img width="0" />e<img width="0" /> <img width="0" />i<img width="0" />s<img width="0" /> <img width="0" />n<img width="0" />o<img width="0" /> <img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />b<img width="0" />r<img width="0" />e<img width="0" />a<img width="0" />k<img width="0" />,<img width="0" /> <img width="0" />s<img width="0" />o<img width="0" /> <img width="0" />t<img width="0" />h<img width="0" />e<img width="0" /> <img width="0" />r<img width="0" />e<img width="0" />a<img width="0" />d<img width="0" />e<img width="0" />r<img width="0" /> <img width="0" />c<img width="0" />a<img width="0" />n<img width="0" /> <img width="0" />c<img width="0" />o<img width="0" />p<img width="0" />y<img width="0" />-<img width="0" />p<img width="0" />a<img width="0" />s<img width="0" />t<img width="0" />e<img width="0" /> <img width="0" />t<img width="0" />h<img width="0" />e<img width="0" /> <img width="0" />t<img width="0" />e<img width="0" />x<img width="0" />t<img width="0" /> <img width="0" />w<img width="0" />i<img width="0" />t<img width="0" />h<img width="0" />o<img width="0" />u<img width="0" />t<img width="0" /> <img width="0" />g<img width="0" />e<img width="0" />t<img width="0" />t<img width="0" />i<img width="0" />n<img width="0" />g<img width="0" /> <img width="0" />a<img width="0" />n<img width="0" />y<img width="0" /> <img width="0" /> <img width="0" /> <img width="0" />e<img width="0" />x<img width="0" />t<img width="0" />r<img width="0" />a<img width="0" /> <img width="0" /> <img width="0" /> <img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />b<img width="0" />r<img width="0" />e<img width="0" />a<img width="0" />k<img width="0" />s<img width="0" />.<img width="0" />"<img width="0" />
</span></div>
<div class='console output'> <img width="0" /> <img width="0" />A<img width="0" />n<img width="0" />d<img width="0" /> <img width="0" />o<img width="0" />v<img width="0" />e<img width="0" />r<img width="0" />l<img width="0" />o<img width="0" />n<img width="0" />g<img width="0" /> <img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />s<img width="0" /> <img width="0" />a<img width="0" />r<img width="0" />e<img width="0" /> <img width="0" />b<img width="0" />r<img width="0" />o<img width="0" />k<img width="0" />e<img width="0" />n<img width="0" /> <img width="0" />a<img width="0" />u<img width="0" />t<img width="0" />o<img width="0" />m<img width="0" />a<img width="0" />t<img width="0" />i<img width="0" />c<img width="0" />a<img width="0" />l<img width="0" />l<img width="0" />y<img width="0" />,<img width="0" /> <img width="0" />b<img width="0" />u<img width="0" />t<img width="0" /> <img width="0" />t<img width="0" />h<img width="0" />e<img width="0" />r<img width="0" />e<img width="0" /> <img width="0" />i<img width="0" />s<img width="0" /> <img width="0" />n<img width="0" />o<img width="0" /> <img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />b<img width="0" />r<img width="0" />e<img width="0" />a<img width="0" />k<img width="0" />,<img width="0" /> <img width="0" />s<img width="0" />o<img width="0" /> <img width="0" />t<img width="0" />h<img width="0" />e<img width="0" /> <img width="0" />r<img width="0" />e<img width="0" />a<img width="0" />d<img width="0" />e<img width="0" />r<img width="0" /> <img width="0" />c<img width="0" />a<img width="0" />n<img width="0" /> <img width="0" />c<img width="0" />o<img width="0" />p<img width="0" />y<img width="0" />-<img width="0" />p<img width="0" />a<img width="0" />s<img width="0" />t<img width="0" />e<img width="0" /> <img width="0" />t<img width="0" />h<img width="0" />e<img width="0" /> <img width="0" />t<img width="0" />e<img width="0" />x<img width="0" />t<img width="0" /> <img width="0" />w<img width="0" />i<img width="0" />t<img width="0" />h<img width="0" />o<img width="0" />u<img width="0" />t<img width="0" /> <img width="0" />g<img width="0" />e<img width="0" />t<img width="0" />t<img width="0" />i<img width="0" />n<img width="0" />g<img width="0" /> <img width="0" />a<img width="0" />n<img width="0" />y<img width="0" /> <img width="0" /> <img width="0" /> <img width="0" />e<img width="0" />x<img width="0" />t<img width="0" />r<img width="0" />a<img width="0" /> <img width="0" /> <img width="0" /> <img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />b<img width="0" />r<img width="0" />e<img width="0" />a<img width="0" />k<img width="0" />s<img width="0" />.<img width="0" />
</div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>m<img width="0" />k<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" /> <img width="0" />'<img width="0" />e<img width="0" />x<img width="0" />t<img width="0" />r<img width="0" />a<img width="0" /> <img width="0" /> <img width="0" /> <img width="0" />w<img width="0" />h<img width="0" />i<img width="0" />t<img width="0" />e<img width="0" />s<img width="0" />p<img width="0" />a<img width="0" />c<img width="0" />e<img width="0" /> <img width="0" /> <img width="0" /> <img width="0" />a<img width="0" />l<img width="0" />s<img width="0" />o<img width="0" /> <img width="0" />w<img width="0" />o<img width="0" />r<img width="0" />k<img width="0" />s<img width="0" /> <img width="0" />i<img width="0" />n<img width="0" /> <img width="0" />p<img width="0" />r<img width="0" />o<img width="0" />m<img width="0" />p<img width="0" />t<img width="0" /> <img width="0" /> <img width="0" />'<img width="0" />
</span></div>
<div class='console output'></div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>c<img width="0" />d<img width="0" /> <img width="0" />'<img width="0" />e<img width="0" />x<img width="0" />t<img width="0" />r<img width="0" />a<img width="0" /> <img width="0" /> <img width="0" /> <img width="0" />w<img width="0" />h<img width="0" />i<img width="0" />t<img width="0" />e<img width="0" />s<img width="0" />p<img width="0" />a<img width="0" />c<img width="0" />e<img width="0" /> <img width="0" /> <img width="0" /> <img width="0" />a<img width="0" />l<img width="0" />s<img width="0" />o<img width="0" /> <img width="0" />w<img width="0" />o<img width="0" />r<img width="0" />k<img width="0" />s<img width="0" /> <img width="0" />i<img width="0" />n<img width="0" /> <img width="0" />p<img width="0" />r<img width="0" />o<img width="0" />m<img width="0" />p<img width="0" />t<img width="0" /> <img width="0" /> <img width="0" />'<img width="0" />
</span></div>
<div class='console output'></div>
<div class='console'><span class='prompt'>~<img width="0" />/<img width="0" />e<img width="0" />x<img width="0" />t<img width="0" />r<img width="0" />a<img width="0" /> <img width="0" /> <img width="0" /> <img width="0" />w<img width="0" />h<img width="0" />i<img width="0" />t<img width="0" />e<img width="0" />s<img width="0" />p<img width="0" />a<img width="0" />c<img width="0" />e<img width="0" /> <img width="0" /> <img width="0" /> <img width="0" />a<img width="0" />l<img width="0" />s<img width="0" />o<img width="0" /> <img width="0" />w<img width="0" />o<img width="0" />r<img width="0" />k<img width="0" />s<img width="0" /> <img width="0" />i<img width="0" />n<img width="0" /> <img width="0" />p<img width="0" />r<img width="0" />o<img width="0" />m<img width="0" />p<img width="0" />t<img width="0" /> <img width="0" /> <img width="0" /> $ </span><span class='cmd'>e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />s<img width="0" /> <img width="0" />a<img width="0" />r<img width="0" />e<img width="0" /> <img width="0" />n<img width="0" />o<img width="0" />t<img width="0" /> <img width="0" />b<img width="0" />r<img width="0" />o<img width="0" />k<img width="0" />e<img width="0" />n<img width="0" /> <img width="0" />a<img width="0" />t<img width="0" /> <img width="0" />w<img width="0" />o<img width="0" />r<img width="0" />d<img width="0" /> <img width="0" />b<img width="0" />o<img width="0" />u<img width="0" />n<img width="0" />d<img width="0" />a<img width="0" />r<img width="0" />y<img width="0" />.<img width="0" /> <img width="0" />T<img width="0" />h<img width="0" />i<img width="0" />s<img width="0" />o<img width="0" />v<img width="0" />e<img width="0" />r<img width="0" />l<img width="0" />o<img width="0" />n<img width="0" />g<img width="0" />w<img width="0" />o<img width="0" />r<img width="0" />d<img width="0" />c<img width="0" />a<img width="0" />n<img width="0" />n<img width="0" />o<img width="0" />t<img width="0" />b<img width="0" />e<img width="0" />o<img width="0" />n<img width="0" />o<img width="0" />n<img width="0" />e<img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />o<img width="0" />n<img width="0" />l<img width="0" />y<img width="0" />i<img width="0" />n<img width="0" />s<img width="0" />t<img width="0" />e<img width="0" />a<img width="0" />d<img width="0" />i<img width="0" />t<img width="0" />m<img width="0" />u<img width="0" />s<img width="0" />t<img width="0" />b<img width="0" />e<img width="0" />b<img width="0" />r<img width="0" />o<img width="0" />k<img width="0" />e<img width="0" />n<img width="0" />a<img width="0" />t<img width="0" />s<img width="0" />o<img width="0" />m<img width="0" />e<img width="0" />p<img width="0" />o<img width="0" />i<img width="0" />n<img width="0" />t<img width="0" />.<img width="0" />
</span></div>
<div class='console output'>l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />s<img width="0" /> <img width="0" />a<img width="0" />r<img width="0" />e<img width="0" /> <img width="0" />n<img width="0" />o<img width="0" />t<img width="0" /> <img width="0" />b<img width="0" />r<img width="0" />o<img width="0" />k<img width="0" />e<img width="0" />n<img width="0" /> <img width="0" />a<img width="0" />t<img width="0" /> <img width="0" />w<img width="0" />o<img width="0" />r<img width="0" />d<img width="0" /> <img width="0" />b<img width="0" />o<img width="0" />u<img width="0" />n<img width="0" />d<img width="0" />a<img width="0" />r<img width="0" />y<img width="0" />.<img width="0" /> <img width="0" />T<img width="0" />h<img width="0" />i<img width="0" />s<img width="0" />o<img width="0" />v<img width="0" />e<img width="0" />r<img width="0" />l<img width="0" />o<img width="0" />n<img width="0" />g<img width="0" />w<img width="0" />o<img width="0" />r<img width="0" />d<img width="0" />c<img width="0" />a<img width="0" />n<img width="0" />n<img width="0" />o<img width="0" />t<img width="0" />b<img width="0" />e<img width="0" />o<img width="0" />n<img width="0" />o<img width="0" />n<img width="0" />e<img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />o<img width="0" />n<img width="0" />l<img width="0" />y<img width="0" />i<img width="0" />n<img width="0" />s<img width="0" />t<img width="0" />e<img width="0" />a<img width="0" />d<img width="0" />i<img width="0" />t<img width="0" />m<img width="0" />u<img width="0" />s<img width="0" />t<img width="0" />b<img width="0" />e<img width="0" />b<img width="0" />r<img width="0" />o<img width="0" />k<img width="0" />e<img width="0" />n<img width="0" />a<img width="0" />t<img width="0" />s<img width="0" />o<img width="0" />m<img width="0" />e<img width="0" />p<img width="0" />o<img width="0" />i<img width="0" />n<img width="0" />t<img width="0" />.<img width="0" />
</div>
<div class='console'><span class='prompt'>~<img width="0" />/<img width="0" />e<img width="0" />x<img width="0" />t<img width="0" />r<img width="0" />a<img width="0" /> <img width="0" /> <img width="0" /> <img width="0" />w<img width="0" />h<img width="0" />i<img width="0" />t<img width="0" />e<img width="0" />s<img width="0" />p<img width="0" />a<img width="0" />c<img width="0" />e<img width="0" /> <img width="0" /> <img width="0" /> <img width="0" />a<img width="0" />l<img width="0" />s<img width="0" />o<img width="0" /> <img width="0" />w<img width="0" />o<img width="0" />r<img width="0" />k<img width="0" />s<img width="0" /> <img width="0" />i<img width="0" />n<img width="0" /> <img width="0" />p<img width="0" />r<img width="0" />o<img width="0" />m<img width="0" />p<img width="0" />t<img width="0" /> <img width="0" /> <img width="0" /> $ </span><span class='cmd'>c<img width="0" />d<img width="0" /> <img width="0" />.<img width="0" />.<img width="0" />
</span></div>
<div class='console output'></div>
<h2>Asserting output of cmd</h2>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>d<img width="0" />i<img width="0" />e<img width="0" />(<img width="0" />)<img width="0" /> <img width="0" />{<img width="0" /> <img width="0" />h<img width="0" />t<img width="0" />m<img width="0" />l<img width="0" /> <img width="0" />"<img width="0" />d<img width="0" />i<img width="0" />e<img width="0" />d<img width="0" />:<img width="0" /> <img width="0" />$<img width="0" />@<img width="0" />"<img width="0" />;<img width="0" /> <img width="0" />}<img width="0" />
</span></div>
<div class='console output'></div>
<p class='text'>
Function out-was can be used to assert cmd output
</p>
<p class='text'>
First, the empty case, success:
</p>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>t<img width="0" />r<img width="0" />u<img width="0" />e<img width="0" />
</span></div>
<div class='console output'></div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<p class='text'>
And failure:
</p>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>t<img width="0" />r<img width="0" />u<img width="0" />e<img width="0" />
</span></div>
<div class='console output'></div>
died: Error in command output, see diff output for details.<div><span class='output-asserted'><i>Output asserted</i></span></div>
<p class='text'>
Then non-empty:
</p>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />"<img width="0" />n<img width="0" />o<img width="0" />n<img width="0" />-<img width="0" />e<img width="0" />m<img width="0" />p<img width="0" />t<img width="0" />y<img width="0" /> <img width="0" />o<img width="0" />u<img width="0" />t<img width="0" />p<img width="0" />u<img width="0" />t<img width="0" />"<img width="0" />
</span></div>
<div class='console output'>n<img width="0" />o<img width="0" />n<img width="0" />-<img width="0" />e<img width="0" />m<img width="0" />p<img width="0" />t<img width="0" />y<img width="0" /> <img width="0" />o<img width="0" />u<img width="0" />t<img width="0" />p<img width="0" />u<img width="0" />t<img width="0" />
</div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />"<img width="0" />a<img width="0" />c<img width="0" />t<img width="0" />u<img width="0" />a<img width="0" />l<img width="0" />"<img width="0" />
</span></div>
<div class='console output'>a<img width="0" />c<img width="0" />t<img width="0" />u<img width="0" />a<img width="0" />l<img width="0" />
</div>
died: Error in command output, see diff output for details.<div><span class='output-asserted'><i>Output asserted</i></span></div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>d<img width="0" />i<img width="0" />e<img width="0" />(<img width="0" />)<img width="0" /> <img width="0" />{<img width="0" /> <img width="0" />e<img width="0" />r<img width="0" />r<img width="0" />o<img width="0" />r<img width="0" />l<img width="0" />o<img width="0" />g<img width="0" /> <img width="0" />"<img width="0" />$<img width="0" />@<img width="0" />"<img width="0" />;<img width="0" /> <img width="0" />e<img width="0" />x<img width="0" />i<img width="0" />t<img width="0" /> <img width="0" />1<img width="0" />;<img width="0" /> <img width="0" />}<img width="0" />
</span></div>
<div class='console output'></div>
<p class='text'>
stdout and stderr get combined. TODO is there a way to interleave them naturally but still assert them separately?
</p>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />e<img width="0" />r<img width="0" />r<img width="0" /> <img width="0" />><img width="0" /> <img width="0" />/<img width="0" />d<img width="0" />e<img width="0" />v<img width="0" />/<img width="0" />s<img width="0" />t<img width="0" />d<img width="0" />e<img width="0" />r<img width="0" />r<img width="0" />
</span></div>
<div class='console output'>e<img width="0" />r<img width="0" />r<img width="0" />
</div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />o<img width="0" />u<img width="0" />t<img width="0" /> <img width="0" />><img width="0" />><img width="0" /> <img width="0" />/<img width="0" />d<img width="0" />e<img width="0" />v<img width="0" />/<img width="0" />s<img width="0" />t<img width="0" />d<img width="0" />o<img width="0" />u<img width="0" />t<img width="0" /> <img width="0" />&amp;&amp; <img width="0" />e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />e<img width="0" />r<img width="0" />r<img width="0" /> <img width="0" />><img width="0" />><img width="0" /> <img width="0" />/<img width="0" />d<img width="0" />e<img width="0" />v<img width="0" />/<img width="0" />s<img width="0" />t<img width="0" />d<img width="0" />e<img width="0" />r<img width="0" />r<img width="0" />
</span></div>
<div class='console output'>o<img width="0" />u<img width="0" />t<img width="0" /><br/>
e<img width="0" />r<img width="0" />r<img width="0" />
</div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<p class='text'>
Since descript uses files to capture output, append is necessary:
</p>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />o<img width="0" />u<img width="0" />t<img width="0" /> <img width="0" />><img width="0" /> <img width="0" />/<img width="0" />d<img width="0" />e<img width="0" />v<img width="0" />/<img width="0" />s<img width="0" />t<img width="0" />d<img width="0" />o<img width="0" />u<img width="0" />t<img width="0" /> <img width="0" />&amp;&amp; <img width="0" />e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />e<img width="0" />r<img width="0" />r<img width="0" /> <img width="0" />><img width="0" /> <img width="0" />/<img width="0" />d<img width="0" />e<img width="0" />v<img width="0" />/<img width="0" />s<img width="0" />t<img width="0" />d<img width="0" />e<img width="0" />r<img width="0" />r<img width="0" />
</span></div>
<div class='console output'>e<img width="0" />r<img width="0" />r<img width="0" />
</div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<h2>Editing file, inlined content</h2>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>$<img width="0" />E<img width="0" />D<img width="0" />I<img width="0" />T<img width="0" />O<img width="0" />R<img width="0" /> <img width="0" />"<img width="0" />f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" />"<img width="0" />
</span></div>
<div class='editor'>
<div class='add line'>file1 line1</div>
<div class='add line'>file1 line2</div>
</div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>c<img width="0" />a<img width="0" />t<img width="0" /> <img width="0" />f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" />
</span></div>
<div class='console output'>f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" /> <img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />1<img width="0" /><br/>
f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" /> <img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />2<img width="0" />
</div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>$<img width="0" />E<img width="0" />D<img width="0" />I<img width="0" />T<img width="0" />O<img width="0" />R<img width="0" /> <img width="0" />"<img width="0" />f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" />"<img width="0" />
</span></div>
<div class='editor'>
<div class='del line'>file1 line1</div>
<div class='add line'>file1 line1, modified</div>
<div class='keep line'>file1 line2</div>
<div class='add line'>file1 line3, added</div>
</div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>c<img width="0" />a<img width="0" />t<img width="0" /> <img width="0" />f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" />
</span></div>
<div class='console output'>f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" /> <img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />1<img width="0" />,<img width="0" /> <img width="0" />m<img width="0" />o<img width="0" />d<img width="0" />i<img width="0" />f<img width="0" />i<img width="0" />e<img width="0" />d<img width="0" /><br/>
f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" /> <img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />2<img width="0" /><br/>
f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" /> <img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />3<img width="0" />,<img width="0" /> <img width="0" />a<img width="0" />d<img width="0" />d<img width="0" />e<img width="0" />d<img width="0" />
</div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>$<img width="0" />E<img width="0" />D<img width="0" />I<img width="0" />T<img width="0" />O<img width="0" />R<img width="0" /> <img width="0" />"<img width="0" />f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" />"<img width="0" />
</span></div>
<div class='editor'>
<div class='keep line'>file1 line1, modified</div>
<div class='del line'>file1 line2</div>
<div class='keep line'>file1 line3, added</div>
</div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>c<img width="0" />a<img width="0" />t<img width="0" /> <img width="0" />f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" />
</span></div>
<div class='console output'>f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" /> <img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />1<img width="0" />,<img width="0" /> <img width="0" />m<img width="0" />o<img width="0" />d<img width="0" />i<img width="0" />f<img width="0" />i<img width="0" />e<img width="0" />d<img width="0" /><br/>
f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" /> <img width="0" />l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" />3<img width="0" />,<img width="0" /> <img width="0" />a<img width="0" />d<img width="0" />d<img width="0" />e<img width="0" />d<img width="0" />
</div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<h2>Editing file, inlined diff</h2>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>$<img width="0" />E<img width="0" />D<img width="0" />I<img width="0" />T<img width="0" />O<img width="0" />R<img width="0" /> <img width="0" />"<img width="0" />f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" />"<img width="0" />
</span></div>
<div class='editor'>
<div class='add line'>line 1</div>
<div class='add line'>line 2</div>
</div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>$<img width="0" />E<img width="0" />D<img width="0" />I<img width="0" />T<img width="0" />O<img width="0" />R<img width="0" /> <img width="0" />"<img width="0" />f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" />"<img width="0" />
</span></div>
<div class='editor'>
<div class='keep line'>line 1</div>
<div class='keep line'>line 2</div>
<div class='add line'>line 3</div>
</div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>c<img width="0" />a<img width="0" />t<img width="0" /> <img width="0" />f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />1<img width="0" />
</span></div>
<div class='console output'>l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" /> <img width="0" />1<img width="0" /><br/>
l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" /> <img width="0" />2<img width="0" /><br/>
l<img width="0" />i<img width="0" />n<img width="0" />e<img width="0" /> <img width="0" />3<img width="0" />
</div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<h2>Text may contain reserved HTML characters: &lt;i>i&lt;/i> and &amp;</h2>
<p class='text'>
This is a paragraph. It can contain &lt;i>i&lt;/i> and &amp;.
</p>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />"<img width="0" />A<img width="0" />n<img width="0" />d<img width="0" /> <img width="0" />a<img width="0" />l<img width="0" />s<img width="0" />o<img width="0" /> <img width="0" />c<img width="0" />o<img width="0" />m<img width="0" />m<img width="0" />a<img width="0" />n<img width="0" />d<img width="0" />s<img width="0" /> <img width="0" />a<img width="0" />n<img width="0" />d<img width="0" /> <img width="0" />t<img width="0" />h<img width="0" />e<img width="0" />i<img width="0" />r<img width="0" /> <img width="0" />o<img width="0" />u<img width="0" />t<img width="0" />p<img width="0" />u<img width="0" />t<img width="0" />:<img width="0" /> <img width="0" />&lt;i<img width="0" />><img width="0" />i<img width="0" />&lt;/<img width="0" />i<img width="0" />><img width="0" /> <img width="0" />a<img width="0" />n<img width="0" />d<img width="0" /> <img width="0" />&amp;"<img width="0" />
</span></div>
<div class='console output'>A<img width="0" />n<img width="0" />d<img width="0" /> <img width="0" />a<img width="0" />l<img width="0" />s<img width="0" />o<img width="0" /> <img width="0" />c<img width="0" />o<img width="0" />m<img width="0" />m<img width="0" />a<img width="0" />n<img width="0" />d<img width="0" />s<img width="0" /> <img width="0" />a<img width="0" />n<img width="0" />d<img width="0" /> <img width="0" />t<img width="0" />h<img width="0" />e<img width="0" />i<img width="0" />r<img width="0" /> <img width="0" />o<img width="0" />u<img width="0" />t<img width="0" />p<img width="0" />u<img width="0" />t<img width="0" />:<img width="0" /> <img width="0" />&lt;i<img width="0" />><img width="0" />i<img width="0" />&lt;/<img width="0" />i<img width="0" />><img width="0" /> <img width="0" />a<img width="0" />n<img width="0" />d<img width="0" /> <img width="0" />&amp;
</div>
<h2>Handling non-zero exit status of commands</h2>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>d<img width="0" />i<img width="0" />e<img width="0" />(<img width="0" />)<img width="0" /> <img width="0" />{<img width="0" /> <img width="0" />h<img width="0" />t<img width="0" />m<img width="0" />l<img width="0" /> <img width="0" />"<img width="0" />d<img width="0" />i<img width="0" />e<img width="0" />d<img width="0" />:<img width="0" /> <img width="0" />$<img width="0" />@<img width="0" />"<img width="0" />;<img width="0" /> <img width="0" />}<img width="0" />
</span></div>
<div class='console output'></div>
<p class='text'>
A non-zero exit status is an error, if using the cmd function.
</p>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>f<img width="0" />a<img width="0" />l<img width="0" />s<img width="0" />e<img width="0" />
</span></div>
<div class='console output'>died: Pipeline 'false' exited with status 1. It should have been 0.</div>
<p class='text'>
Function cmde must be used instead.
</p>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>f<img width="0" />a<img width="0" />l<img width="0" />s<img width="0" />e<img width="0" />
</span></div>
<div class='console output'></div>
<p class='text'>
It's an error if the cmde exits with different exit status.
</p>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>t<img width="0" />r<img width="0" />u<img width="0" />e<img width="0" />
</span></div>
<div class='console output'>died: Pipeline 'true' exited with status 0. It should have been 1.</div>
<p class='text'>
Command statuses in a pipeline are asserted individually. First the happy case.
</p>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>f<img width="0" />a<img width="0" />l<img width="0" />s<img width="0" />e<img width="0" /> <img width="0" />|<img width="0" /> <img width="0" />t<img width="0" />r<img width="0" />u<img width="0" />e<img width="0" />
</span></div>
<div class='console output'></div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>t<img width="0" />r<img width="0" />u<img width="0" />e<img width="0" /> <img width="0" />|<img width="0" /> <img width="0" />f<img width="0" />a<img width="0" />l<img width="0" />s<img width="0" />e<img width="0" />
</span></div>
<div class='console output'></div>
<p class='text'>
Then failure.
</p>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>t<img width="0" />r<img width="0" />u<img width="0" />e<img width="0" /> <img width="0" />|<img width="0" /> <img width="0" />f<img width="0" />a<img width="0" />l<img width="0" />s<img width="0" />e<img width="0" />
</span></div>
<div class='console output'>died: Pipeline 'true | false' exited with status 0 1. It should have been 1 0.</div>
<p class='text'>
The bash special parameter 0 always expands to 0, to keep descript more robust. TODO maybe it would be better not to use set -eu.
</p>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>d<img width="0" />i<img width="0" />e<img width="0" />(<img width="0" />)<img width="0" /> <img width="0" />{<img width="0" /> <img width="0" />e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />"<img width="0" />$<img width="0" />@<img width="0" />"<img width="0" />;<img width="0" /> <img width="0" />e<img width="0" />x<img width="0" />i<img width="0" />t<img width="0" /> <img width="0" />1<img width="0" />;<img width="0" /> <img width="0" />}<img width="0" />
</span></div>
<div class='console output'></div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>t<img width="0" />r<img width="0" />u<img width="0" />e<img width="0" />
</span></div>
<div class='console output'></div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />$<img width="0" />?<img width="0" />
</span></div>
<div class='console output'>0<img width="0" />
</div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>f<img width="0" />a<img width="0" />l<img width="0" />s<img width="0" />e<img width="0" />
</span></div>
<div class='console output'></div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />$<img width="0" />?<img width="0" />
</span></div>
<div class='console output'>0<img width="0" />
</div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<h2>Redirects can be used</h2>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />"<img width="0" />i<img width="0" />t<img width="0" /> <img width="0" />w<img width="0" />o<img width="0" />r<img width="0" />k<img width="0" />s<img width="0" />"<img width="0" /> <img width="0" />><img width="0" /> <img width="0" />f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />
</span></div>
<div class='console output'></div>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>c<img width="0" />a<img width="0" />t<img width="0" /> <img width="0" />f<img width="0" />i<img width="0" />l<img width="0" />e<img width="0" />
</span></div>
<div class='console output'>i<img width="0" />t<img width="0" /> <img width="0" />w<img width="0" />o<img width="0" />r<img width="0" />k<img width="0" />s<img width="0" />
</div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<h2>Forged path</h2>
<p class='text'>
Absolute paths in output get forged, partly for security and partly for reproducible builds.
</p>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>p<img width="0" />w<img width="0" />d<img width="0" />
</span></div>
<div class='console output'>/<img width="0" />h<img width="0" />o<img width="0" />m<img width="0" />e<img width="0" />/<img width="0" />h<img width="0" />a<img width="0" />c<img width="0" />k<img width="0" />e<img width="0" />r<img width="0" />
</div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<p class='text'>
But out-was assertions need to use real paths! Forging must be visual only.
</p>
<div class='console'><span class='prompt'>~<img width="0" /> $ </span><span class='cmd'>m<img width="0" />k<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" /> <img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" /> <img width="0" />&amp;&amp; <img width="0" />c<img width="0" />d<img width="0" /> <img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" />
</span></div>
<div class='console output'></div>
<div class='console'><span class='prompt'>~<img width="0" />/<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" /> $ </span><span class='cmd'>p<img width="0" />w<img width="0" />d<img width="0" />
</span></div>
<div class='console output'>/<img width="0" />h<img width="0" />o<img width="0" />m<img width="0" />e<img width="0" />/<img width="0" />h<img width="0" />a<img width="0" />c<img width="0" />k<img width="0" />e<img width="0" />r<img width="0" />/<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" />
</div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<div class='console'><span class='prompt'>~<img width="0" />/<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" /> $ </span><span class='cmd'>e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />$<img width="0" />P<img width="0" />W<img width="0" />D<img width="0" />/<img width="0" />a<img width="0" />n<img width="0" />o<img width="0" />t<img width="0" />h<img width="0" />e<img width="0" />r<img width="0" />-<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />
</span></div>
<div class='console output'>/<img width="0" />h<img width="0" />o<img width="0" />m<img width="0" />e<img width="0" />/<img width="0" />h<img width="0" />a<img width="0" />c<img width="0" />k<img width="0" />e<img width="0" />r<img width="0" />/<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" />/<img width="0" />a<img width="0" />n<img width="0" />o<img width="0" />t<img width="0" />h<img width="0" />e<img width="0" />r<img width="0" />-<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />
</div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<p class='text'>
Absolute paths on command lines are also forged.
</p>
<div class='console'><span class='prompt'>~<img width="0" />/<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" /> $ </span><span class='cmd'>e<img width="0" />c<img width="0" />h<img width="0" />o<img width="0" /> <img width="0" />P<img width="0" />W<img width="0" />D<img width="0" /> <img width="0" />e<img width="0" />x<img width="0" />p<img width="0" />a<img width="0" />n<img width="0" />d<img width="0" />e<img width="0" />d<img width="0" /> <img width="0" />i<img width="0" />n<img width="0" /> <img width="0" />t<img width="0" />h<img width="0" />e<img width="0" /> <img width="0" />d<img width="0" />e<img width="0" />s<img width="0" />c<img width="0" />r<img width="0" />i<img width="0" />p<img width="0" />t<img width="0" /> <img width="0" />s<img width="0" />c<img width="0" />r<img width="0" />i<img width="0" />p<img width="0" />t<img width="0" />:<img width="0" /> <img width="0" />/<img width="0" />h<img width="0" />o<img width="0" />m<img width="0" />e<img width="0" />/<img width="0" />h<img width="0" />a<img width="0" />c<img width="0" />k<img width="0" />e<img width="0" />r<img width="0" />/<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" />
</span></div>
<div class='console output'>P<img width="0" />W<img width="0" />D<img width="0" /> <img width="0" />e<img width="0" />x<img width="0" />p<img width="0" />a<img width="0" />n<img width="0" />d<img width="0" />e<img width="0" />d<img width="0" /> <img width="0" />i<img width="0" />n<img width="0" /> <img width="0" />t<img width="0" />h<img width="0" />e<img width="0" /> <img width="0" />d<img width="0" />e<img width="0" />s<img width="0" />c<img width="0" />r<img width="0" />i<img width="0" />p<img width="0" />t<img width="0" /> <img width="0" />s<img width="0" />c<img width="0" />r<img width="0" />i<img width="0" />p<img width="0" />t<img width="0" />:<img width="0" /> <img width="0" />/<img width="0" />h<img width="0" />o<img width="0" />m<img width="0" />e<img width="0" />/<img width="0" />h<img width="0" />a<img width="0" />c<img width="0" />k<img width="0" />e<img width="0" />r<img width="0" />/<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" />
</div>
<div><span class='output-asserted'><i>Output asserted</i></span></div>
<div class='console'><span class='prompt'>~<img width="0" />/<img width="0" />d<img width="0" />i<img width="0" />r<img width="0" />1<img width="0" /> $ </span><span class='cmd'>c<img width="0" />d<img width="0" /> <img width="0" />.<img width="0" />.<img width="0" />
</span></div>
<div class='console output'></div>
<h2>Empty section &lt; &amp;</h2>
</body>
</html>
